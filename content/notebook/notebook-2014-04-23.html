---
title: Notebook Entry
subtitle: April 23, 2014
description:
created: !!timestamp '2014-04-23 17:59:43'
tags:
    - notebook
---

{% mark image -%}
{%- endmark %}

{% mark excerpt -%}
{% restructuredtext %}


{% endrestructuredtext %}
{%- endmark %}

{% restructuredtext %}

This is potentially a very simple way to think about what we measure and
estimate from force plate and motion capture data in gait.

- :math:`m_t`: the treadmill mass
- :math:`m_f`: the foot mass
- :math:`m_s`: the shank mass
- :math:`F_p`: the force applied to perturb the displacement of the treadmill,
  and thus the whole system
- :math:`F_c`: the contact force between the foot at the treadmill. There are
  models that can represent contact, but for now I'll just assume that it is
  some kind of force producer. Note that this ignores the fact that forces
  plates measure the forces between two masses. This has to be accounted for
  when moving the force plate, but the following analysis assumes we can
  measure the force at the surface (not at the load cells).
- :math:`F_o`, :math:`F_a`: Both of these are active forces applied between the
  foot and the shank. This is synonmous to the forces generated by actively
  controlling the muscles that connect the two bodies and can be generalized to
  joint torques for a typical walking model.
- :math:`k`, :math:`c`: A simple stiffness and damping force generators that
  represent the passive portions force generators between the foot and the
  shank.
- :math:`y_t,y_f,y_s`: The distances of each mass above the ground.
- :math:`\Delta y`: The distance between the foot and shank, synonymous with a
  joint angle.

The equations of motion of this system look like this:

..math::

  -gm_t - m_t\dot{v}_t - F_c + F_p = 0

  -c\Delta y - gm_f - k\Delta y - m_f\dot{v}_f - F_a - F_o + F_c = 0

  c\Delta y - gm_s + k\Delta y - m_s\dot{v}_s + F_a + F_o = 0

Now thinking about the second equation we can measure, or estimate reasonably
well, these quantities: :math:`\Delta y, g, m_f, \dot{v}_f, F_c`. So inverse
dynamics says we can solve for :math:`F` given our measurements:

..math::

  F = F_c - gm_f - m_f\dot{v}_f = c\Delta v + k\Delta y + F_a + F_o


:math:`F` is synomous with the joint torques that we estimate from inverse
dynamics, i.e. the first equation. F is the sum of both the passive and active
forces in the joint. If we had reasonable estimates of the passive portion of
the joint forces, i.e.  :math:`c` and :math:`k` in our case, then we could
compute as the active forces.

So if I have a real system that can be reasonably modeled by this model we
could excite it, take measurements, and get and compute estimates of the forces
acting between the foot and shank.

Now let's define what the active forces are. Gait is periodic. So if
:math:`F_p`, :math`F_a=0` and :math:`F_o=sin(t)` are used to excite the real
system, there will be some steady state periodic motion of the system. We call
the steady state :math:`\Delta y, \Delta v` :math:`y_o,v_o`. These are
synonymous with the "open loop" joint angles and rates that follow from driving
a gait model for walking. This steady state is the desired system state under,
i.e. the state trajectories we want to track.

So now if we perturb this oscillating real system with :math:`F_p`, with white
noise for example, then then :math:`\Delta y` and :math:`\Delta v` will no
longer equal :math:`y_o` and :math:`v_o`. Now we can think of :math:`F_a`
applying some feedback to drive :math:`\Delta y,\Delta v` to :math:`y_o,v_o`.
So:

..math::

  F_a = c_a[v_o - \Delta v] + k_a[y_o - \Delta y]

The joint forces then look like this:

..math::

  F = c\Delta v + k\Delta y + c_a[v_o - \Delta v] + k_a[y_o - \Delta y] + F_o

  F = \Delta v[c - c_a] + \Delta y[k - k_a] + c_a v_o + k_a y_o + F_o

We can measure or estimate only :math:`F,\Delta v, \Delta y` and we'd really
like to figure out what :math:`c_a` and :math:`k_a` are, i.e. the active gains
in the controller. If :math:`F_o` and :math:`v_o` are periodic and we have
enough measurements in time, i.e. from multiple periods, then we can get
estimates of :math:`c_t=c-c_a` and :math:`k_t=k-k_a`. These are the combined
passive stiffness and damping with the active stiffness and damping (controller
gains). We also estimate this periodic term:

..math::

  F^* = c_a v_o + k_a y_o + F_o

This shows that the best we can do it to estimate "gains" which are
combinations of the stiffness and damping from passive and active forces.

Now if we can take data when :math:`F_p=0` we can get estimates of
:math:`v_o` and :math:`y_o` which could allow us to estimate both the active
and passive gains.

Other researchers in biomechanics talk about "impedance" and "joint impedance".
For example in [Rouse2012]_ defines impedance in the ankle joint like:

..math::

  T = I \ddot{\theta} + c \dot{\theta} + k \theta

And he doesn't use standard inverse dynamics, he neglects the foot mass, so his
joint torque estimate follows this form:

..math::

  T = T_c = I\ddot{theta} + c \dot{\theta} + k \theta + gm_fl\theta + T_a + T_o

He then measures :math:`F, \ddot{\theta}, \dot{\theta}, \theta` during a single
step (while :math:`F_p\neq0`) and estimates :math:`m,c,k`. So his estimated
parameters are clearly a lumping of active and passive portions and he even
throws in the terms that we deal with in the inverse dynamics calculations.
This model also assumes that the active portions are functions of angle,
angular rate, and angular acceleration. I'm not sure if the I term is strictly
the inertia of the foot as he claims it. I guess it is if there is no chance of
"acceleration" feedback.

.. [Rouse2012] Rouse et al., “Estimation of Human Ankle Impedance during Walking Using the
Perturberator Robot.”

{% endrestructuredtext %}
